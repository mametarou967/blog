---
title: "<プロトタイプ> RaspberryPiとSORACOMを使ったシェアサイクルの緊急返却をサポートするプロダクト"
date: 2021-05-30T14:20:06+09:00
draft: false
tags:
- RaspberryPi
- SORACOM
- GPS
- ぴーすくる
image: images/postIcon/make1.png
description: レンタサイクルを緊急時に返却しやすい
---

## 背景

[広島市シェアサイクル ぴーすくる](https://docomo-cycle.jp/hiroshima/)は広島市内で利用できるレンタサイクルです。ぴーすくるの無人のサイクルポートは広島市内に100個所程度設置されており、これらの場所から手続きを行うと1時間165円で自転車を借りることができます。ぴーすくるは買い物、通勤、観光など幅広い目的の交通手段として利用されています。

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/ぴーすくる.png" >}}

<br>

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/サイクルポート.jpg" >}}

レンタサイクルの特徴の一つとして、**借りた場所と同じ場所に返却しなくてよい**というものがあります。100個所のサイクルポートのどこに返却しても問題ないので、片道だけ利用したり、途中で乗り捨てたり、と自転車の面倒を最後まで見なくて良いメリットがあります。
また、以下のようなトラブルや急な予定変更のときに、近くのサイクルポートに乗り捨てれるというメリットもあります。

* 雨が降り出したので、電車に乗り換えたい、または、近くの店で雨宿りしたい
* ぴーすくるが故障したので、徒歩に切り替えたい
* 目的地が変わりぴーすくるでは行けない範囲になったので、タクシーを捕まえて移動したい
* 良さそうなお店を見つけたので、ここで乗り捨てていきたい

一方で、ぴーすくる（レンタサイクル）の弱点として、トラブルや急な予定変更のときに、**最寄りのサイクルポートが見つけられない**という問題が発生します。

ぴーすくるの利用者は基本的に借りるサイクルポートと返すサイクルポートの場所は下調べしている（はず）のですが、他のサイクルポートの位置をすべて把握しているわけではないので、トラブルが発生したり予定変更の際に、**最寄りのサイクルポートとそこまでの行き方を調べる必要**が発生します。
せっかく、十分なサイクルポートがあり、乗り捨てという潜在的なメリットを持っていながら、利用者が素早く最寄りのサイクルポートが発見できないがために魅力が半減していると思います。
（※ぴーすくるはGPSを搭載しており(おそらく）サイクルポート付近以外での乗り捨ては「返却操作」ができず、利用料金が追加でかかってしまったり、運営者様に迷惑がかかってしまいます）

そこで、ぴーすくる利用者が簡単操作でもよりのサイクルポートまでの行き方をしらべられるようなプロダクトを考えました。

## 要件

* ぴーすくるの利用者がボタンを押すと、現在地から一番近いサイクルポートまでの地図と道順が表示されること
* 現在の場所で雨が降りそうなら利用者にLEDでお知らせして、現在地から一番近いサイクルポートまでの地図と道順が表示されること

## システム構成図

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/システム構成図.jpg" >}}

## 使用した部品

|製品名|用途|
|:---|:---|
|Raspberry Pi 3 Model B+|ターゲットデバイス|
|docomo L-02C|通信のため|
|SORACOM Air SIMカード plan-D|通信のため|
|GPS受信キット AE-GYSFDMAXB|現在地の取得|
|Kuman 3.5 HDMI Display-B|現在地から一番近いサイクルポートまでの経路表示|
|タクトスイッチ|利用者が一番近いサイクルポートを知りたいときに押す|
|青色LED|現在位置で悪い天気が観測されたら利用者にお知らせする|


## 結線図

実際に部品を結線した様子は以下のようになります。

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/結線図1.JPG" >}}

見栄えが悪いので、UI部分を残して箱に入れました。

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/結線図2.JPG" >}}

UI部分は以下のようになります。

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/結線図3.JPG" >}}

## 動作概要

* 利用者きっかけの経路表示
    * タクトスイッチを押下する
    * GPS受信機より受信した現在の緯度、経度を確認する
    * あらかじめ、保持している100箇所のサイクルポートリストと現在の緯度経度を比較し、最も近いサイクルポートの緯度経度を求める
    * Google Mapに上記2点間の経路を要求し、ディスプレイに結果を表示する
* 現在地の天候きっかけの経路表示
    * GPS受信機より受信した現在の緯度、経度を引数としOpen Weather Mapに天気を確認する
    * 天気が悪かった場合（雨～雷）以下の内容を実施
        * 青色LEDの点灯
        * 「利用者きっかけの経路表示」同様の手順で、ディスプレイに経路表示

## 実証実験

使用感を確認するために

1. 広島県の西広島駅から中区本通経由で宇品に移動する
1. 本通通過中に友人からLINEが入り合流して店に行く提案を受ける
1. 徒歩に切り替えるために、本プロダクトを使用し最寄りのサイクルポートを素早く探しだして自転車を止める

というストーリーを試してみます。
スタート地点・乗り捨て希望地点（友人から連絡が入った地点）・目的地は以下のようになります。

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_地図.jpg" >}}

まずは、西広島駅のサイクルポートで自分のお好みの自転車を選びます。

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_西広駅前.JPG" >}}

<br>

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_西広駅前_自転車.JPG" >}}

選択した自転車に今回のプロダクトを装着します。（プロトタイプなのでむき出しでの装着となります）

こちらが装着前で

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_装着前_横.JPG" >}}

<br>

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_装着前_ハンドル.JPG" >}}


こちらが装着後です。（プロトタイプなので、むき出しです）

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_装着後_横.JPG" >}}

<br>

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_装着後_ハンドル.JPG" >}}

ディスプレイを小さな物を選択したので、それほど大げさにならずにつけることができました。早速、目的地に向けて走りだします。ぴーすくるは電動機がついているのでグイグイ進みます。

広島国際会議場近くまで到着したときに、友人からメッセージが入ります。
ここで、ぴーすくるを乗り捨て、徒歩に切り替えるために、「本プロダクト」登場です。近くのサイクルポートへの経路を表示するためにタクトスイッチを押します。

すると

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_経路表示.JPG" >}}

[動画はこちら](https://www.youtube.com/watch?v=HjppXQlyWSM)

ちゃんと表示されました。広島国際会議場の前にサイクルポートがあり、自転車を押して行っても2分程度て付くようです。地図に従っていくと、ありました！サイクルポート！本プロダクトのおかげで素早くアクセスできました。

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_サイクルポート到着1.JPG" >}}

<br>

{{< figure src="/images/post/RaspberryPiとSORACOMを使ったレンタサイクルの緊急返却をサポートするプロダクト/実証実験_サイクルポート到着2.JPG" >}}

本プロダクトの実用性を確認できました。

## 実装手順

1. raspberry pi3 B+セットアップ
1. 各ハードウェアの結線
1. [RaspberryPiでL-02Cを使ってSORACOM Airに接続する](https://uepon.hatenadiary.com/entry/2017/04/08/115936)
1. [Raspberry Pi3のPythonでGPSを扱う](https://qiita.com/AmbientData/items/fff54c8ac8ec95aeeee6)
1. 後述するリポジトリをダウンロードをして実行

## 実行手順

* sudo wvdial
* chromium-browser --kiosk
* python3 main.py

## ソース

本プロトタイプで使用したプログラムは以下に置いてあります。
* [rentaCycleSupport](https://github.com/mametarou967/rentaCycleSupport)

## 参考
1. [Chromium をフルスクリーンで開く](https://klee-arc.hatenablog.com/entry/2017/06/12/041000)












